<sl-hmaster-details [SelectedDetail]="currCell" (DetailClosed)="editclose($event)">
  <ng-template #hmdmaster>

    <div cdkDropListGroup class="drop-list-group">

      <button title="Edit" type="button" class="button button-circle-white button-edit" (click)="EditMode=!EditMode" *ngIf="!EditMode" >
        <i class="fa-solid fa-pencil mr-1"></i>
      </button>
      <button title="Save" type="button" class="button button-circle-accent button-edit" (click)="saveConf()" *ngIf="EditMode">
        <i class="fa-solid fa-floppy-disk mr-1"></i>
      </button>

      <div *ngFor="let r of GetRows(); let idr = index" class="row" [style.top]="r + '%'">
        <div *ngFor="let c of GetCols(); let idc = index" cdkDropList class='cell'
          [id]="'cell_' + r + '_' + c" (cdkDropListDropped)="MoveControl(idr, idc, $event)"
            >

          <!-- ne dovrebbe esistere sempre uno solo, il loop mi serve solo x avere il riferimento (esiste un altro modo?)-->

          <button title="add control" *ngIf="dashboardItems(idr, idc).length == 0 && EditMode" class="button button-addcontrol"
            (click)="addControl(idr, idc)">
            <i class="fa-solid fa-plus fa-2x"></i>
          </button>

          <ng-container *ngFor="let cell of dashboardItems(idr, idc)">
            <div class="card" cdkDrag [cdkDragDisabled]="!EditMode" (cdkDragEnded)="dragend(cell.IdItem)" [id]="'control_' + cell.IdItem"
              [style.width]="cell.width * 100 + '%'"
              [style.height]=" cell.height * 100 + '%'"
              >
              <div class="card-header" *ngIf="EditMode">
                <div class="card-header-column">
                  <div class="card-header-row">
                    <!--Drag icon-->

                    <button title="drag" class="button button-primary" cdkDragHandle (mousedown)="dragstart(cell.IdItem)">
                      <i class="fa-solid fa-arrows-alt"></i>
                    </button>

                    <!--Selezione elemento da visualizzare -->
                    <ng-select bindLabel="name" bindValue="id" class="flex-stretch" placeholder="Seleziona "
                      [(ngModel)]="cell.idComponent" appendTo="body">
                      <ng-option *ngFor="let itm of childrennames; let idx = index" [value]="idx">
                        {{ childrennames[idx] }}
                      </ng-option>
                    </ng-select>

                    <button title="Setup Control" class="button button-primary" (click)="setupControl(cell)">
                      <i class="fa-solid fa-pencil"></i>
                    </button>
                    <!-- Elimina controllo -->
                    <button title="Remove Control" class="button button-danger" (click)="removeControl(cell.IdItem)">
                      <i class="fa-solid fa-trash"></i>
                    </button>
                  </div>

                </div>
              </div>
              <div class="card-body">
                {{cell.title}}
                <div class="card-body-display">
                  <ng-container *ngIf="children && cell.idComponent > -1 && dragging != 'control_' + cell.IdItem">
                    <ng-container [ngTemplateOutlet]="children[cell.idComponent]"
                      [ngTemplateOutletContext]="{$implicit:cell}"></ng-container>
                  </ng-container>
                  <ng-container *ngIf="cell.idComponent == -1"> </ng-container>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
      </div>

    </div>


  </ng-template>

  <ng-template #hmddetails>
    <img
    alt="backimage"
    class="header-backimage"
    [src]="'assets/media/backgrounds/14-640x480.jpg'"
  />
  <div class="header-avatar-container">
    <sl-avatar
      class="avatar-big"
      [src]="'assets/icons/' + currCell!.icon"
    ></sl-avatar>
  </div>
  <div class="header-details-name">
    Configurazione widget
  </div>

    <div class="config-container">
      <div class="config-values">
      <div class="size-value">
        <label>Width</label>
        <input title="width" type="number"  class=" border-text" [(ngModel)]="currwidth" min="1" max="10" >
      </div>
      <div  class="size-value">
        <label>Height</label>
        <input title="height" type="number"  class="border-text" [(ngModel)]="currheight" min="1" max="10">
      </div>
      </div>

    </div>
    <div class="config-container">
      <div class="config-values">
        <div class="config-title">

          <label>Title</label>
          <input title="title" type="text"  class="border-text" [(ngModel)]="currtitle">

        </div>
      </div>
    </div>
    <ng-container *ngIf="children && currCell!.idComponent > -1">
      <ng-container [ngTemplateOutlet]="children[currCell!.idComponent]"
        [ngTemplateOutletContext]="{$implicit: currCell}"></ng-container>
    </ng-container>
  </ng-template>
</sl-hmaster-details>
